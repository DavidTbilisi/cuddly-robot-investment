<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Investment Projection Simulator</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="app" class="container">
    <div class="header">
      <h1>Investment Projection Simulator</h1>
      <div class="row">
        <span class="pill">Currency: {{ currency }}</span>
        <button class="btn secondary" @click="resetToDefaults">Reset</button>
        <button class="btn" @click="downloadCSV">Download CSV</button>
      </div>
    </div>

    <details class="card quick-help" id="how-to-use">
      <summary>Quick start</summary>
      <ol class="help-list">
        <li id="help-starting-capital"><strong>Starting Capital</strong> â€” your current investable assets at year 0.
        </li>
        <li id="help-income-monthly"><strong>Monthly Income (now)</strong> â€” current average gross income per month.
        </li>
        <li id="help-expenses-monthly"><strong>Monthly Expenses (now)</strong> â€” current average monthly expenses.</li>
        <li id="help-income-growth"><strong>Income Growth / year (%)</strong> â€” expected annual income growth (nominal).
        </li>
        <li id="help-return"><strong>Investment Return / year (%)</strong> â€” expected portfolio return (nominal).</li>
        <li id="help-inflation"><strong>Inflation / year (%)</strong> â€” applies to expenses each year.</li>
        <li id="help-years"><strong>Projection Years</strong> â€” how many years to simulate.</li>
        <li id="help-contrib-factor"><strong>Interest on current-year contributions</strong> â€” 0Ã— (end), 0.5Ã—
          (mid-year),
          1Ã— (start). Default 1Ã—.</li>
      </ol>
      <div class="subtle tip">Tips: CSV exports raw numbers. Capital is floored at 0 (no borrowing). Change any input
        and
        the table + chart update instantly.</div>
    </details>

    <div class="grid">
      <!-- Controls -->
      <div class="card">
        <h3 style="margin-top:0">Inputs</h3>
        <div class="controls">
          <div class="field">
            <label>Starting Capital</label>
            <input type="number" v-model.number="params.startingCapital" min="0" step="100" />
          </div>
          <div class="field">
            <label>Monthly Income (now)</label>
            <input type="number" v-model.number="params.incomeMonthly" min="0" step="1" />
          </div>
          <div class="field">
            <label>Monthly Expenses (now)</label>
            <input type="number" v-model.number="params.expensesMonthly" min="0" step="1" />
          </div>
          <div class="field">
            <label>Income Growth / year (%)</label>
            <input type="number" v-model.number="params.incomeGrowthPct" min="-100" step="0.1" />
          </div>
          <div class="field">
            <label>Investment Return / year (%)</label>
            <input type="number" v-model.number="params.returnPct" min="-100" step="0.1" />
          </div>
          <div class="field">
            <label>Inflation (affects expenses) / year (%)</label>
            <input type="number" v-model.number="params.inflationPct" min="-100" step="0.1" />
          </div>
          <div class="field">
            <label>Projection Years</label>
            <input type="number" v-model.number="params.years" min="1" max="60" />
          </div>
          <div class="field">
            <label>Assumption: interest on current-year contributions</label>
            <select v-model.number="params.contributionInterestFactor">
              <option :value="0">0Ã— (end of year)</option>
              <option :value="0.5">0.5Ã— (mid-year average)</option>
              <option :value="1">1Ã— (start of year)</option>
            </select>
          </div>
        </div>
        <div class="footer">
          <span class="note">Delta = Income âˆ’ Expenses (monthly). Contributions = 12 Ã— Delta.</span>
          <span class="note">Capital floors at 0 (no borrowing). Default contribution interest = 1Ã—
            (start-of-year).</span>
        </div>
      </div>

      <!-- 50/30/20 Strategy Recommendations -->
      <div class="card strategy-card">
        <h3 style="margin-top:0">ðŸ’° 1 Million Goal - 50/30/20 Strategy</h3>
        <div class="strategy-explanation">
          <p><strong>50/30/20 Rule:</strong> Allocate 50% for needs, 30% for wants, 20% for savings/investments</p>
        </div>

        <div class="strategy-grid">
          <div class="current-analysis">
            <h4>ðŸ“Š Current Status</h4>
            <div class="metric-row">
              <span class="metric-label">Current Savings Rate:</span>
              <span class="metric-value" :class="currentSavingsRate >= 20 ? 'good' : 'needs-improvement'">
                {{ Math.round(currentSavingsRate) }}%
              </span>
            </div>
            <div class="metric-row">
              <span class="metric-label">Years to $1M (current rate):</span>
              <span class="metric-value">
                {{ yearsToMillionCurrent > 100 ? '100+' : Math.round(yearsToMillionCurrent) }} years
              </span>
            </div>
            <div class="metric-row">
              <span class="metric-label">Final Capital (30 years):</span>
              <span class="metric-value">
                {{ fmt(finalCapital30Years) }}
              </span>
            </div>
          </div>

          <div class="recommendations">
            <h4>ðŸŽ¯ 50/30/20 Recommendations</h4>
            <div class="metric-row">
              <span class="metric-label">Recommended Monthly Income:</span>
              <span class="metric-value recommended">
                {{ fmt(recommendedIncome) }}
              </span>
            </div>
            <div class="metric-row">
              <span class="metric-label">Max Monthly Expenses (80%):</span>
              <span class="metric-value">
                {{ fmt(recommendedExpenses) }}
              </span>
            </div>
            <div class="metric-row">
              <span class="metric-label">Monthly Investment (20%):</span>
              <span class="metric-value investment">
                {{ fmt(recommendedInvestment) }}
              </span>
            </div>
            <div class="metric-row">
              <span class="metric-label">Years to $1M (20% rate):</span>
              <span class="metric-value target">
                {{ yearsToMillionTarget }} years
              </span>
            </div>
          </div>
        </div>

        <div class="strategy-actions">
          <button class="btn strategy-btn" @click="applyFiftyThirtyTwenty" :disabled="!canApplyStrategy">
            ðŸŽ¯ Apply 50/30/20 Strategy
          </button>
          <button class="btn secondary strategy-btn" @click="optimizeForMillion">
            âš¡ Optimize for $1M Goal
          </button>
          <span class="strategy-note" v-if="!canApplyStrategy">
            Current income too low for 50/30/20 strategy with $1M goal in reasonable timeframe
          </span>
        </div>

        <div class="strategy-breakdown">
          <h4>ðŸ“ˆ Strategic Breakdown</h4>
          <div class="breakdown-grid">
            <div class="breakdown-item needs">
              <div class="breakdown-header">
                <span class="percentage">50%</span>
                <span class="category">Needs</span>
              </div>
              <div class="amount">{{ fmt(recommendedIncome * 0.5) }}</div>
              <div class="description">Housing, food, utilities, minimum debt payments</div>
            </div>
            <div class="breakdown-item wants">
              <div class="breakdown-header">
                <span class="percentage">30%</span>
                <span class="category">Wants</span>
              </div>
              <div class="amount">{{ fmt(recommendedIncome * 0.3) }}</div>
              <div class="description">Entertainment, dining out, hobbies, subscriptions</div>
            </div>
            <div class="breakdown-item savings">
              <div class="breakdown-header">
                <span class="percentage">20%</span>
                <span class="category">Savings</span>
              </div>
              <div class="amount">{{ fmt(recommendedIncome * 0.2) }}</div>
              <div class="description">Emergency fund + investments for wealth building</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Multi-Metric Overview Chart -->
      <div class="card chart-wrap">
        <div class="chart-toolbar">
          <label for="chart-type"><strong>Chart Type</strong></label>
          <select id="chart-type" v-model="chartType">
            <option value="line">Line Chart</option>
            <option value="area">Area Chart</option>
            <option value="column">Column Chart</option>
            <option value="combo">Combo Chart</option>
          </select>

          <label><input type="checkbox" v-model="showMultipleMetrics" /> Multi-Metric View</label>
          <label><input type="checkbox" v-model="showPoints" /> Show Points</label>
          <label><input type="checkbox" v-model="enableZoom" /> Enable Zoom</label>

          <div class="metric-toggles" v-if="showMultipleMetrics">
            <label v-for="opt in metricOptions" :key="opt.value">
              <input type="checkbox" v-model="activeMetrics" :value="opt.value" /> {{ opt.label }}
            </label>
          </div>
          <div v-else>
            <label for="metric"><strong>Metric</strong></label>
            <select id="metric" v-model="metric">
              <option v-for="opt in metricOptions" :key="opt.value" :value="opt.value">{{ opt.label }}</option>
            </select>
          </div>
        </div>
        <div id="main-chart" class="gchart" :data-draws="chartDraws"></div>
        <div class="chart-description">
          <p><strong>Main Investment Projection Chart:</strong> This interactive chart displays your selected financial
            metrics over time. Use the controls above to switch between different chart types (line, area, column,
            combo) and toggle multi-metric view to compare multiple indicators simultaneously.</p>
          <p><strong>Key Features:</strong> Enable zoom to focus on specific time periods, show points for precise data
            visualization, and hover over any data point for detailed tooltips with exact values. The multi-metric view
            allows you to overlay different measurements like capital growth, contributions, and interest earnings for
            comprehensive analysis.</p>
        </div>
      </div>

      <!-- Capital Growth Breakdown Chart -->
      <div class="card chart-wrap">
        <div class="chart-toolbar">
          <h4 style="margin:0">Capital Growth Sources</h4>
          <label><input type="checkbox" v-model="showStackedView" /> Stacked View</label>
          <label for="breakdown-year"><strong>Year Focus</strong></label>
          <select id="breakdown-year" v-model="focusYear">
            <option v-for="row in rows" :key="row.year" :value="row.year">Year {{ row.year }}</option>
          </select>
        </div>
        <div class="chart-row">
          <div id="breakdown-chart" class="gchart-half"></div>
          <div id="pie-chart" class="gchart-half"></div>
        </div>
        <div class="chart-description">
          <p><strong>Capital Growth Source Analysis:</strong> These complementary charts break down where your wealth
            comes from each year.</p>
          <p><strong>Left Chart - Growth Sources Timeline:</strong> Shows how different components contribute to your
            capital growth over time. Toggle 'Stacked View' to see cumulative contributions or unstacked to compare
            individual growth sources. The four components are: Starting Capital (red), Annual Contributions (blue),
            Interest on Existing Capital (orange), and Interest on New Contributions (purple).</p>
          <p><strong>Right Chart - Year-Specific Breakdown:</strong> A pie chart showing the composition of capital
            sources for your selected focus year. This helps you understand what percentage of your wealth comes from
            initial capital, ongoing contributions, and compound interest effects. Use the year selector to explore
            different time periods.</p>
        </div>
      </div>

      <!-- Financial Flow Analysis -->
      <div class="card chart-wrap">
        <div class="chart-toolbar">
          <h4 style="margin:0">Financial Flow Analysis</h4>
          <label><input type="checkbox" v-model="showCumulativeView" /> Cumulative View</label>
          <label><input type="checkbox" v-model="showPercentages" /> Show as Percentages</label>
        </div>
        <div class="chart-row">
          <div id="cashflow-chart" class="gchart-half"></div>
          <div id="ratios-chart" class="gchart-half"></div>
        </div>
        <div class="chart-description">
          <p><strong>Financial Flow Analysis:</strong> Monitor your cash flow patterns and financial health indicators.
          </p>
          <p><strong>Left Chart - Cash Flow Trends:</strong> Displays your annualized income (green line), expenses (red
            line), and net cash flow available for investment (blue columns). This combo chart helps you visualize how
            your earning power and spending evolve over time, and how much you can consistently invest. Watch for the
            gap between income and expensesâ€”the wider it gets, the more you can invest.</p>
          <p><strong>Right Chart - Financial Ratios:</strong> Three key performance indicators: Savings Rate (green)
            shows what percentage of income you save, Capital Growth Rate (orange) indicates your year-over-year wealth
            increase, and Expense Ratio (red) tracks spending as a percentage of income. Higher savings rates and lower
            expense ratios generally indicate better financial discipline.</p>
        </div>
      </div>

      <!-- Performance Analytics -->
      <div class="card chart-wrap">
        <div class="chart-toolbar">
          <h4 style="margin:0">Performance Analytics</h4>
          <label for="performance-metric"><strong>Focus</strong></label>
          <select id="performance-metric" v-model="performanceMetric">
            <option value="returns">Return Analysis</option>
            <option value="growth">Growth Rates</option>
            <option value="efficiency">Capital Efficiency</option>
          </select>
        </div>
        <div id="performance-chart" class="gchart"></div>
        <div class="chart-description">
          <p><strong>Performance Analytics Dashboard:</strong> Deep-dive into your investment performance with advanced
            metrics.</p>
          <p><strong>Return Analysis Mode:</strong> Breaks down your total investment returns into capital returns (from
            existing assets) and contribution returns (from new investments). This helps you understand how much growth
            comes from your initial capital versus ongoing contributions.</p>
          <p><strong>Growth Rates Mode:</strong> Shows year-over-year percentage changes in capital, income, and
            expenses. Look for consistent capital growth rates and income growth that outpaces expense growth for
            optimal wealth building.</p>
          <p><strong>Capital Efficiency Mode:</strong> Measures how effectively your money works for you. Capital
            Efficiency shows return per dollar invested, ROI displays your return on investment percentage, and Payback
            Period indicates how long it takes for investment returns to recover your initial capital.</p>
          <div class="performance-tip"><strong>ðŸ’¡ Tip:</strong> Use these metrics to evaluate different scenariosâ€”higher
            contribution rates, different return assumptions, or varying expense levelsâ€”to optimize your investment
            strategy.</div>
        </div>
      </div>

      <!-- Table -->
      <div class="card" style="margin-top:0">
        <h3 style="margin-top:0">Projection Table</h3>
        <div class="subtle" style="margin-bottom:8px">All values are annualized where noted. Interest uses simple annual
          accrual.</div>
        <table>
          <thead>
            <tr>
              <th>Year</th>
              <th>Monthly Income</th>
              <th>Monthly Expenses</th>
              <th>Delta (monthly)</th>
              <th>Contrib. (annual)</th>
              <th>Capital (last year)</th>
              <th>% on last year's capital</th>
              <th>% on current-year contributions</th>
              <th>Final capital</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="row in rows" :key="row.year">
              <td>{{ row.year }}</td>
              <td>{{ fmt(row.incomeMonthly) }}</td>
              <td :class="row.expensesMonthly>row.incomeMonthly ? 'neg' : ''">{{ fmt(row.expensesMonthly) }}</td>
              <td :class="row.deltaMonthly<0 ? 'neg' : 'pos'">{{ fmt(row.deltaMonthly) }}</td>
              <td :class="row.contribution<0 ? 'neg' : 'pos'">{{ fmt(row.contribution) }}</td>
              <td>{{ fmt(row.capitalStart) }}</td>
              <td :class="row.interestOnStart<0 ? 'neg' : 'pos'">{{ fmt(row.interestOnStart) }}</td>
              <td :class="row.interestOnContribution<0 ? 'neg' : 'pos'">{{ fmt(row.interestOnContribution) }}</td>
              <td :class="row.capitalEnd<0 ? 'neg' : 'pos'">{{ fmt(row.capitalEnd) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <details class="tests card" style="margin-top:16px">
      <summary>Developer tests</summary>
      <ul id="test-results" class="subtle"></ul>
    </details>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="script.js"></script>
</body>

</html>