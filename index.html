<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Investment Projection Simulator</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="app" class="container">
    <div class="header">
      <h1>Investment Projection Simulator</h1>
      <div class="row">
        <span class="pill">Currency: {{ currency }}</span>
        <button class="btn secondary" @click="resetToDefaults">Reset</button>
        <button class="btn" @click="downloadCSV">Download CSV</button>
      </div>
    </div>

    <details class="card quick-help" id="how-to-use">
      <summary>Quick start</summary>
      <ol class="help-list">
        <li id="help-starting-capital"><strong>Starting Capital</strong> — your current investable assets at year 0.
        </li>
        <li id="help-income-monthly"><strong>Monthly Income (now)</strong> — current average gross income per month.
        </li>
        <li id="help-expenses-monthly"><strong>Monthly Expenses (now)</strong> — current average monthly expenses.</li>
        <li id="help-income-growth"><strong>Income Growth / year (%)</strong> — expected annual income growth (nominal).
        </li>
        <li id="help-return"><strong>Investment Return / year (%)</strong> — expected portfolio return (nominal).</li>
        <li id="help-inflation"><strong>Inflation / year (%)</strong> — applies to expenses each year.</li>
        <li id="help-years"><strong>Projection Years</strong> — how many years to simulate.</li>
        <li id="help-contrib-factor"><strong>Interest on current-year contributions</strong> — 0× (end), 0.5×
          (mid-year),
          1× (start). Default 1×.</li>
      </ol>
      <div class="subtle tip">Tips: CSV exports raw numbers. Capital is floored at 0 (no borrowing). Change any input
        and
        the table + chart update instantly.</div>
    </details>

    <div class="grid">
      <!-- Controls -->
      <div class="card">
        <h3 style="margin-top:0">Inputs</h3>
        <div class="controls">
          <div class="field">
            <label>Starting Capital</label>
            <input type="number" v-model.number="params.startingCapital" min="0" step="100" />
          </div>
          <div class="field">
            <label>Monthly Income (now)</label>
            <input type="number" v-model.number="params.incomeMonthly" min="0" step="1" />
          </div>
          <div class="field">
            <label>Monthly Expenses (now)</label>
            <input type="number" v-model.number="params.expensesMonthly" min="0" step="1" />
          </div>
          <div class="field">
            <label>Income Growth / year (%)</label>
            <input type="number" v-model.number="params.incomeGrowthPct" min="-100" step="0.1" />
          </div>
          <div class="field">
            <label>Investment Return / year (%)</label>
            <input type="number" v-model.number="params.returnPct" min="-100" step="0.1" />
          </div>
          <div class="field">
            <label>Inflation (affects expenses) / year (%)</label>
            <input type="number" v-model.number="params.inflationPct" min="-100" step="0.1" />
          </div>
          <div class="field">
            <label>Projection Years</label>
            <input type="number" v-model.number="params.years" min="1" max="60" />
          </div>
          <div class="field">
            <label>Assumption: interest on current-year contributions</label>
            <select v-model.number="params.contributionInterestFactor">
              <option :value="0">0× (end of year)</option>
              <option :value="0.5">0.5× (mid-year average)</option>
              <option :value="1">1× (start of year)</option>
            </select>
          </div>
        </div>
        <div class="footer">
          <span class="note">Delta = Income − Expenses (monthly). Contributions = 12 × Delta.</span>
          <span class="note">Capital floors at 0 (no borrowing). Default contribution interest = 1×
            (start-of-year).</span>
        </div>
      </div>

      <!-- Multi-Metric Overview Chart -->
      <div class="card chart-wrap">
        <div class="chart-toolbar">
          <label for="chart-type"><strong>Chart Type</strong></label>
          <select id="chart-type" v-model="chartType">
            <option value="line">Line Chart</option>
            <option value="area">Area Chart</option>
            <option value="column">Column Chart</option>
            <option value="combo">Combo Chart</option>
          </select>
          
          <label><input type="checkbox" v-model="showMultipleMetrics" /> Multi-Metric View</label>
          <label><input type="checkbox" v-model="showPoints" /> Show Points</label>
          <label><input type="checkbox" v-model="enableZoom" /> Enable Zoom</label>
          
          <div class="metric-toggles" v-if="showMultipleMetrics">
            <label v-for="opt in metricOptions" :key="opt.value">
              <input type="checkbox" v-model="activeMetrics" :value="opt.value" /> {{ opt.label }}
            </label>
          </div>
          <div v-else>
            <label for="metric"><strong>Metric</strong></label>
            <select id="metric" v-model="metric">
              <option v-for="opt in metricOptions" :key="opt.value" :value="opt.value">{{ opt.label }}</option>
            </select>
          </div>
        </div>
        <div id="main-chart" class="gchart" :data-draws="chartDraws"></div>
        <div class="subtle">Interactive chart with multiple visualization options • Hover for detailed tooltips</div>
      </div>

      <!-- Capital Growth Breakdown Chart -->
      <div class="card chart-wrap">
        <div class="chart-toolbar">
          <h4 style="margin:0">Capital Growth Sources</h4>
          <label><input type="checkbox" v-model="showStackedView" /> Stacked View</label>
          <label for="breakdown-year"><strong>Year Focus</strong></label>
          <select id="breakdown-year" v-model="focusYear">
            <option v-for="row in rows" :key="row.year" :value="row.year">Year {{ row.year }}</option>
          </select>
        </div>
        <div class="chart-row">
          <div id="breakdown-chart" class="gchart-half"></div>
          <div id="pie-chart" class="gchart-half"></div>
        </div>
        <div class="subtle">Left: Growth sources over time • Right: Composition for selected year</div>
      </div>

      <!-- Financial Flow Analysis -->
      <div class="card chart-wrap">
        <div class="chart-toolbar">
          <h4 style="margin:0">Financial Flow Analysis</h4>
          <label><input type="checkbox" v-model="showCumulativeView" /> Cumulative View</label>
          <label><input type="checkbox" v-model="showPercentages" /> Show as Percentages</label>
        </div>
        <div class="chart-row">
          <div id="cashflow-chart" class="gchart-half"></div>
          <div id="ratios-chart" class="gchart-half"></div>
        </div>
        <div class="subtle">Left: Income vs Expenses trends • Right: Key financial ratios</div>
      </div>

      <!-- Performance Analytics -->
      <div class="card chart-wrap">
        <div class="chart-toolbar">
          <h4 style="margin:0">Performance Analytics</h4>
          <label for="performance-metric"><strong>Focus</strong></label>
          <select id="performance-metric" v-model="performanceMetric">
            <option value="returns">Return Analysis</option>
            <option value="growth">Growth Rates</option>
            <option value="efficiency">Capital Efficiency</option>
          </select>
        </div>
        <div id="performance-chart" class="gchart"></div>
        <div class="subtle">Advanced performance metrics and trend analysis</div>
      </div>

      <!-- Table -->
      <div class="card" style="margin-top:0">
        <h3 style="margin-top:0">Projection Table</h3>
        <div class="subtle" style="margin-bottom:8px">All values are annualized where noted. Interest uses simple annual
          accrual.</div>
        <table>
          <thead>
            <tr>
              <th>Year</th>
              <th>Monthly Income</th>
              <th>Monthly Expenses</th>
              <th>Delta (monthly)</th>
              <th>Contrib. (annual)</th>
              <th>Capital (last year)</th>
              <th>% on last year's capital</th>
              <th>% on current-year contributions</th>
              <th>Final capital</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="row in rows" :key="row.year">
              <td>{{ row.year }}</td>
              <td>{{ fmt(row.incomeMonthly) }}</td>
              <td :class="row.expensesMonthly>row.incomeMonthly ? 'neg' : ''">{{ fmt(row.expensesMonthly) }}</td>
              <td :class="row.deltaMonthly<0 ? 'neg' : 'pos'">{{ fmt(row.deltaMonthly) }}</td>
              <td :class="row.contribution<0 ? 'neg' : 'pos'">{{ fmt(row.contribution) }}</td>
              <td>{{ fmt(row.capitalStart) }}</td>
              <td :class="row.interestOnStart<0 ? 'neg' : 'pos'">{{ fmt(row.interestOnStart) }}</td>
              <td :class="row.interestOnContribution<0 ? 'neg' : 'pos'">{{ fmt(row.interestOnContribution) }}</td>
              <td :class="row.capitalEnd<0 ? 'neg' : 'pos'">{{ fmt(row.capitalEnd) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <details class="tests card" style="margin-top:16px">
      <summary>Developer tests</summary>
      <ul id="test-results" class="subtle"></ul>
    </details>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="script.js"></script>
</body>

</html>